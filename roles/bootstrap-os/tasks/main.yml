- name: Bootstrap | change hostname
  replace:
    path: /etc/hostname
    regexp: '^ip-(\d{2,3}-){3}\d{2,3}$'
    replace: "{{ item.instances[0].tags.Name }}"
    backup: yes
  with_items: "{{ ec2.results }}"
  when: cloud_provider == 'aws'

- name: Bootstrap | Check if bootstrap is needed
  raw: which "{{ item }}"  
  register: need_bootstrap
  failed_when: false
  with_items:
    - python
    - pip

- name: Bootstrap | Install python 2.x and pip
  raw:
    sudo apt-get update && \
    DEBIAN_FRONTEND=noninteractive sudo apt-get install -y python-minimal python-pip
  when:
    "{{ need_bootstrap.results | map(attribute='rc') | sort | last | bool }}"
  become: true
  become_user: "{{ become_user }}"
